# Task specifications

## Task Spec

Task specification is created by the developer. Most arguments are optional. Can be formatted as
JSON. Specifying parameters as a JSON file is supported. In Python code, these parameters can
be provided using function decorators.

The parameters are stored as a dictionary, but may be communicated a JSON file.

- required:
    - execution parameter:  execution_parameter
        - Specifies how the task is executed

- optional:
    - task id: string
        - An identifier for the task, used to store and retrieve information and for dependencies.
        - Default to random UUID
    - time limit: integer or time_units, default = 1min
        - Upper limit for the tasks runtime in seconds or provided unit
    - memory limit: integer or memory_units, default = 1M
        - Upper limit of memory the task can use in megabytes or provided unit
    - input path: string, multiple
        - list of files required for the task
        - standard protocol specifications (ftp://, http://, ...). File system is default.
    - input folder: string, multiple
        - folder that must contain a file
    - input file expression: string, multiple
        - regular expression that must match a file
    - single file task: bool, default False
        - Run a separate task for each file in required_folder or matching required_file_expression
    - filepath parameter: string, multiple
        - parameter name for passing a dynamically determined file name to the task
    - ready signal: string, multiple
        - A signal from the main process that the task can be run. (Initial implementation through the files system).
    - output folder: string
        - folder for output files and logs
    - disk space limit: integer or memory units
        - Amount of free disk space required to run the task
    - number of threads: integer, default=1
        - Maximum number of threads the task will use
    - parameters: dict, default = {}
        - A dictionary of parameter names and values
    - checkpointing specification
        - is interruptable: bool = False
            - Whether the task can be interrupted and resumed
        - what to do in case of failure
    - priority: integer, default 0
        - Task priority. Higher priority tasks are executed first.
    - niceness: integer, default 0
        - negated priority 
    - dependency: list of task ids, default []
        - tasks that need to be run first.


### Time_unit
 - timedelta formattable string
 - We only support [pandas.to_timedelta](https://pandas.pydata.org/docs/reference/api/pandas.to_timedelta.html)


### Memory_unit
 - integer followed by "M" or "G"

### Execution parameter
Multiple options:
1. Executable
    - required:
        - Executable: str
            - Full path to an executable file.
        - number of threads
    - optional:
        - Parameter mapping 
2. Python function
    - required:
        - Pickled function file
        - number of threads


### Checkpointing Spec
Specifies whether the task can be interrupted and if it can, when

Options:
1. None
    - The task cannot be interrupted without losing all progress
2. Critical
    - The task cannot be interrupted without compromising the main process.
3. Checkpoint
    - The task creates periodic checkpoint files. The modified timestamp of the file shows when a checkpoint has been created.
    - Filename: str
        - Path to the checkpoint file
4. Process files
    - The task processes files and remove / moves them when done. File removed from a folder corresponds to progress.
    - Filename: str, multiple, optional
        - If provided, when any of these files is removed, we consider that progress in the task.
        - default: List of all input files provided in other options


## Scheduler Spec

JSON formatted information that specifies when and how the task is executed.

Generated by the task reader. (Or by hand by the developer).



## Engine spec

- required:
    - Task id : str
    - execution parameter : str
    - is interruptable: bool
    - cpu time
    - memory limit
    - is interruptable
- optional:
    - input file path: file_name, multiple
    - input folder path: folder
